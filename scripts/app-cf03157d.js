"use strict";function nextHour(a){var o=moment();return void 0!==a&&o.add("minute",a),o.set("hour",o.get("hour")+1),o.set("minute",0),o.set("second",0),o.set("millisecond",0),o}function LoginController(a,o,t,e){a.credentials={username:"",password:""},a.login=function(a){e.login(a).then(function(a){o.$broadcast(t.loginSuccess),o.setCurrentUser(a)},function(){o.$broadcast(t.loginFailed)})},a.hideDialog=function(){a.visible=!1}}angular.module("jalagatiJoga",["ngRoute","ngResource","mobile-angular-ui","restangular"]).config(["$routeProvider","$locationProvider",function(a){a.when("/",{templateUrl:"app/pages/home.html"}).when("/register",{templateUrl:"app/pages/register.html",data:{"public":!0}}).when("/alkalmak/uj",{templateUrl:"app/alkalmak/uj-alkalom-form.html",controller:"UjAlkalomController"}).when("/alkalmak/:alkalomId",{templateUrl:"app/alkalmak/egy-alkalom.html",controller:"AlkalomController",reloadOnSearch:!1}).when("/alkalmak",{templateUrl:"app/alkalmak/lista-alkalmak.html",controller:"AlkalomListaController"}).when("/jogasok/:jogasId/alkalmak",{controller:"JogasAlkalmakController",templateUrl:"app/jogas/alkalmak.html"}).when("/jogasok/:jogasId/berlet",{controller:"BerletCtrl",templateUrl:"app/jogas/berlet.html"}).when("/jogasok/:jogasId",{controller:"JogasCtrl",templateUrl:"app/jogas/jogas-egy.html"}).when("/jogasok",{controller:"JogasokCtrl",templateUrl:"app/jogas/jogasok-lista.html"}).otherwise({redirectTo:"/"})}]).value("redirectToAfterLogin",{url:"/"}).run(["$rootScope","$http","AUTH_EVENTS","AuthService","$location","redirectToAfterLogin",function(a,o,t,e,l,s){a.$on("$routeChangeStart",function(o,l){e.isAuthorized(l.data&&l.data.public)||(o.preventDefault(),s.url=l.url,a.$broadcast(e.isAuthenticated()?t.notAuthorized:t.notAuthenticated))}),a.$on(t.loginSuccess,function(){l.path(s.url)})}]).config(["$httpProvider",function(a){a.interceptors.push(["$injector",function(a){return a.get("AuthInterceptor")}]),a.interceptors.push(function(){return{request:function(a){var o=a.url.split("/").splice(-1)[0];return-1===o.indexOf(".")&&(a.url="http://localhost:8000"+a.url),a}}})}]).factory("AuthInterceptor",["$rootScope","$q","AUTH_EVENTS",function(a,o,t){return{responseError:function(e){return a.$broadcast({401:t.notAuthenticated,403:t.notAuthorized,419:t.sessionTimeout,440:t.sessionTimeout}[e.status],e),o.reject(e)}}}]).controller("ApplicationController",["$scope","$rootScope","USER_ROLES","AuthService",function(a,o,t,e){a.sidebarUrl="app/pages/sidebar.html",a.currentUser=null,a.userRoles=t,a.isAuthorized=e.isAuthorized,o.setCurrentUser=function(o){a.currentUser=o}}]),angular.module(["jalagatiJoga"]).value("jogatartok",["Sisi","Lakshmi"]).value("varosok",["Budapest, Király utca","Szeged"]).factory("Alkalom",["$resource",function(a){var o=a("/alkalmak/:id/:action",{id:"@_id",action:"@action"},{addResztvevo:{method:"POST",params:{action:"addResztvevo",jogasId:!0}},removeResztvevo:{method:"POST",params:{action:"removeResztvevo",jogasId:!0}}});return o}]).controller("UjAlkalomController",["$scope","$location","Alkalom","jogatartok","varosok",function(a,o,t,e,l){var s=nextHour().toDate();a.jogatartok=e,a.varosok=l,a.ujAlkalom={tartja:null,segit:a.currentUser.name,date:s,time:s},a.setupAlkalom=function(a){a.starts=moment(a.date.toISOString().split("T")[0]+" "+a.time.toLocaleTimeString()).toDate(),a=new t(a),a.$save(function(a){o.path("/alkalmak/"+a._id)})}}]).controller("AlkalomListaController",["$scope","Alkalom",function(a,o){a.alkalmak=o.query()}]).controller("AlkalomController",["$scope","$routeParams","$window","Jogas","$location","Alkalom","varosok",function(a,o,t,e,l,s,r){a.alkalom=s.get({id:o.alkalomId}),a.jogasok=e.query(),a.varosok=r,a.addJogas=function(o){l.search("next",l.path()),l.search("name",o),l.search("city",a.alkalom.location),l.path("/jogasok")},a.addResztvevo=function(a,o){o.$addResztvevo({jogasId:a._id})},a.removeResztvevo=function(a,o){o.$removeResztvevo({jogasId:a._id})}}]),angular.module(["jalagatiJoga"]).factory("Jogas",["$resource",function(a){var o=a("/jogasok/:id/:action",{id:"@_id",action:"@action"},{ujBerlet:{method:"POST",params:{action:"ujberlet"}}});return o}]).controller("JogasokCtrl",["$scope","$location","Jogas","varosok",function(a,o,t,e){a.jogasok=t.query(),a.varosok=e,a.search=a.location="",a.jogas={name:o.search().name,city:o.search().city},a.addJogas=function(a){var e=new t(a);e.$save(function(a){o.path(o.search().next?o.search().next:"/jogasok/"+a._id)})}}]).controller("JogasCtrl",["$scope","$routeParams","$window","Jogas","varosok",function(a,o,t,e,l){a.jogas=e.get({id:o.jogasId}),a.varosok=l,a.save=function(){a.jogas.$save({},function(){t.history.back()})}}]).controller("BerletCtrl",["$scope","$routeParams","$window","Jogas",function(a,o,t,e){a.jogas=e.get({id:o.jogasId}),a.window=t,a.save=function(o){a.jogas.$ujBerlet(o,function(){t.history.back()})}}]).controller("JogasAlkalmakController",["$scope","$routeParams","Jogas",function(a,o,t){a.jogas=t.get({id:o.jogasId})}]),angular.module("jalagatiJoga").service("Session",["$http",function(a){return this.create=function(o,t,e){this.id=o,this.name=t,this.token=e,a.defaults.headers.common.Authorization="Bearer "+e},this.destroy=function(){this.id=null,this.name=null,this.token=null,a.defaults.headers.common.Authorization=""},this}]).factory("AuthService",["$http","Session",function(a,o){var t={};return t.login=function(t){return a.post("/auth/login",t).then(function(a){return o.create(a.data.id,a.data.name,a.data.token),a.data})},t.register=function(t){return a.post("/auth/signup",t).then(function(a){return o.create(a.data.id,a.data.name,a.data.token),a.data})},t.isAuthenticated=function(){return!!o.id},t.isAuthorized=function(a){return a||!!o.id},t}]),angular.module("jalagatiJoga").constant("AUTH_EVENTS",{loginSuccess:"auth-login-success",loginFailed:"auth-login-failed",logoutSuccess:"auth-logout-success",sessionTimeout:"auth-session-timeout",notAuthenticated:"auth-not-authenticated",notAuthorized:"auth-not-authorized"}).constant("USER_ROLES",{all:"*",admin:"admin",guest:"guest"}),LoginController.$inject=["$scope","$rootScope","AUTH_EVENTS","AuthService"],angular.module(["jalagatiJoga"]).directive("loginDialog",["AUTH_EVENTS",function(a){return{restrict:"A",scope:{setCurrentUser:"&"},template:'<div ng-if="visible" ng-include="\'app/login/login-form.html\'">',link:function(o){var t=function(){o.visible=!0},e=function(){o.visible=!1};o.visible=!1,o.$on(a.notAuthenticated,t),o.$on(a.sessionTimeout,t),o.$on(a.loginSuccess,e)},controller:LoginController}}]).directive("formAutofillFix",["$timeout",function(a){return function(o,t,e){t.prop("method","post"),e.ngSubmit&&a(function(){t.unbind("submit").bind("submit",function(a){a.preventDefault(),t.find("input, textarea, select").trigger("input").trigger("change").trigger("keydown"),o.$apply(e.ngSubmit)})})}}]),angular.module(["jalagatiJoga"]).directive("bkRegistrationForm",["AUTH_EVENTS",function(a){return{restrict:"E",scope:{setCurrentUser:"&"},templateUrl:"app/login/registration-form.html",controller:["$scope","$rootScope","AuthService",function(o,t,e){o.credentials={username:"",password:"",password2:""},o.register=function(l){e.register(l).then(function(e){t.$broadcast(a.loginSuccess),o.setCurrentUser(e)},function(){t.$broadcast(a.loginFailed)})}}]}}]),angular.module("jalagatiJoga").run(["$templateCache",function(a){a.put("app/alkalmak/egy-alkalom.html",'<section class="section container-fluid"><div class="row"><h2>{{alkalom.starts | date:\'medium\' }} - {{alkalom.location}} / {{alkalom.tartja}}</h2><div class="col-xs-12"><form class="form-inline"><div class="form-group col-xs-4"><label for="filter" class="sr-only">Szűrés</label> <input id="filter" class="form-control" type="text" autofocus="" ng-model="search"></div><div class="form-group col-xs-4"><label for="varos-filter" class="sr-only">Városok</label><select id="varos-filter" class="form-control" ng-model="location" ng-options="l for l in varosok"><option value="">--</option></select></div><div class="form-group col-xs-4"><button ng-click="addJogas(search)" ng-show="search" class="btn btn-primary">Új jógázó</button></div></form></div><ul class="col-xs-6 list-group"><li class="list-group-item" ng-repeat="jogas in jogasok | filter:location | filter:search | orderBy:name"><div class="pull-right"><a ng-click="addResztvevo(jogas, alkalom)" class="btn btn-primary"><i class="fa fa-check"></i>Választ</a> <a ng-href="#/jogasok/{{jogas._id}}/berlet" class="btn btn-default"><i class="fa fa-star-half"></i>Bérletek</a></div><div class="list-group-text with-buttons">{{jogas.name}}</div></li></ul><div class="col-xs-6"><h3>Résztvevők:</h3><ul class="list-group"><li class="list-group-item" ng-repeat="resztvevo in alkalom.resztvevok | orderBy:name"><div class="pull-right"><button ng-click="removeResztvevo(resztvevo, alkalom)" class="btn btn-warning"><i class="fa fa-times"></i></button></div><div class="with-buttons">{{resztvevo.name}}</div></li></ul></div></div></section>'),a.put("app/alkalmak/lista-alkalmak.html",'<section class="section container-fluid"><h1 class="page-header">Alkalmak</h1><div ng-repeat="alkalom in alkalmak" class="list-group"><a class="list-group-item" ng-href="#/alkalmak/{{alkalom._id}}">{{alkalom.tartja}}, {{alkalom.location}}, {{alkalom.starts | date:\'medium\'}} <i class="fa fa-chevron-right pull-right"></i></a></div></section>'),a.put("app/alkalmak/uj-alkalom-form.html",'<section class="section container-fluid"><h2>Új alkalom indítása</h2><form role="form" ng-submit="setupAlkalom(ujAlkalom)"><div class="form-group"><label for="jogatarto">Jógatartó</label><select id="jogatarto" class="form-control" autofocus="" ng-model="ujAlkalom.tartja" ng-required="true" ng-options="j for j in jogatartok"></select></div><div class="form-group"><label for="segito">Segítő</label> <input id="segito" type="text" placeholder="Segítő" class="form-control" ng-model="ujAlkalom.segit"></div><div class="form-group"><label for="helyszin">Helyszín</label><select id="helyszin" class="form-control" ng-model="ujAlkalom.location" ng-required="true" ng-options="l for l in varosok"></select></div><div class="form-group"><label for="datum">Dátum</label> <input id="datum" type="date" class="form-control" ng-model="ujAlkalom.date" required="required"> <input id="idopont" type="time" placeholder="Időpont" class="form-control" ng-model="ujAlkalom.time" required="required"></div><button type="submit" class="btn btn-primary">Mehet</button> <a ng-href="#/alkalmak">Alkalmak</a></form></section>'),a.put("app/jogas/alkalmak.html",'<section class="section container-fluid"><div class="row"><h1>Mikor járt nálunk {{jogas.name}}?</h1><ul class="col-xs-12"><li ng-repeat="alkalom in jogas.alkalmak"><a ng-href="#/alkalmak/{{alkalom.alkalom}}">{{alkalom.date}}</a></li></ul></div></section>'),a.put("app/jogas/berlet.html",'<section class="section container-fluid"><h1>{{jogas.name}} bérletei</h1><h2>Új bérlet</h2><form role="form"><div class="form-group"><label>Alkalmak száma: <input type="number" ng-model="berlet.alkalmak" value="0" autofocus=""></label></div><div class="form-group"><label>Kezdő dátum: <input type="date" ng-model="berlet.startDate"></label></div><div class="form-group"><label>Záró dátum<input type="date" ng-model="berlet.endDate"></label></div><div class="form-group"><button class="btn btn-primary" ng-click="save(berlet)">Ok</button> <a ng-click="window.history.back()">Mégse</a></div></form><h2>Korábbi bérletei</h2><ul><li ng-repeat="berlet in jogas.berletek"><div ng-show="{{berlet.alkalmak}}">Alkalmak: {{berlet.alkalmak}}</div><div ng-hide="{{berlet.alkalmak}}">Időszak: {{berlet.startDate | date }}-{{berlet.endDate | date }}</div><div>Felhasználva: {{berlet.felhasznalva.length}}</div></li></ul></section>'),a.put("app/jogas/jogas-egy.html",'<section class="section container-fluid"><h1>{{jogas.name}} adatai</h1><form role="form"><div class="form-group"><label for="jogas-name">Név</label> <input id="jogas-name" class="form-control" type="text" value="{{jogas.name}}" ng-model="jogas.name" ng-required="true"></div><div class="form-group"><label for="jogas-nick">Becenév</label> <input id="jogas-nick" class="form-control" type="text" value="{{jogas.nick}}" ng-model="jogas.nick"></div><div class="form-group"><label for="jogas-email">E-mail</label> <input id="jogas-email" class="form-control" type="text" value="{{jogas.email}}" ng-model="jogas.email"></div><div class="form-group"><label for="jogas-city">Város:</label><select id="jogas-city" class="form-control" ng-model="jogas.city" ng-options="l for l in varosok" ng-required="true"></select></div><button class="btn btn-primary" ng-click="save(jogas)">Ment</button> <button type="reset" class="btn btn-warning">Mégse</button> <a ng-href="#/jogasok/{{jogas._id}}/berlet" class="btn">Bérletek</a> <a href="#/jogasok/{{jogas._id}}/alkalmak" class="btn">Történet</a></form></section>'),a.put("app/jogas/jogasok-lista.html",'<section class="section container-fluid"><div class="row"><div class="col-xs-6"><div class="col-xs-12"><form class="form-inline"><div class="form-group col-xs-6"><label for="filter" class="sr-only">Szűrés</label> <input id="filter" class="form-control" type="text" autofocus="" ng-model="search"></div><div class="form-group col-xs-6"><label for="varos-filter" class="sr-only">Városok</label><select id="varos-filter" class="form-control" ng-model="location" ng-options="l for l in varosok"><option value="">--</option></select></div></form></div><h3>Jógázók</h3><ul class="list-group"><li class="list-group-item" ng-repeat="jogas in jogasok | filter: location | filter:search"><div class="pull-right"><a ng-href="#/jogasok/{{jogas._id}}" class="btn btn-default"><i class="fa fa-user"></i> Adatok</a> <a ng-href="#/jogasok/{{jogas._id}}/berlet" class="btn btn-default"><i class="fa fa-star-half"></i>Bérletek</a> <a href="#/jogasok/{{jogas._id}}/alkalmak" class="btn btn-default"><i class="fa fa-calendar"></i>Történet</a></div><div class="list-group-item-text with-buttons">{{jogas.name}} <span ng-if="jogas.nick">({{jogas.nick}})</span></div></li></ul></div><div class="col-xs-6"><h3>Új jógázó</h3><form role="form" ng-submit="addJogas(jogas)" ng-hide="search"><div class="form-group"><label for="jogas-name">Név</label> <input id="jogas-name" class="form-control" type="text" value="{{jogas.name}}" ng-model="jogas.name" ng-required="true"></div><div class="form-group"><label for="jogas-nick">Becenév</label> <input id="jogas-nick" class="form-control" type="text" value="{{jogas.nick}}" ng-model="jogas.nick"></div><div class="form-group"><label for="jogas-email">E-mail</label> <input id="jogas-email" class="form-control" type="text" value="{{jogas.email}}" ng-model="jogas.email"></div><div class="form-group"><label for="jogas-city">Város:</label><select id="jogas-city" class="form-control" ng-model="jogas.city" ng-options="l for l in varosok" ng-required="true"></select></div><button type="submit" class="btn btn-primary">Add</button></form></div></div></section>'),a.put("app/login/login-form.html",'<iframe src="sink.html" name="sink" style="display:none"></iframe><div class="modal"><div class="modal-backdrop in"></div><div class="modal-dialog"><form class="modal-content" name="loginForm" action="sink.html" target="sink" method="post" ng-submit="login(credentials)" novalidate="" form-autofill-fix=""><div class="modal-header"><h4 class="modal-title">Bejelentkezés</h4></div><div class="modal-body"><div class="form-group"><label for="username">Username:</label> <input class="form-control" type="text" id="username" autofocus="" ng-model="credentials.username" ng-required=""></div><div class="form-group"><label for="password">Password:</label> <input class="form-control" type="password" id="password" ng-model="credentials.password" ng-required=""></div></div><div class="modal-footer"><a class="btn" ng-href="#/register" ng-click="hideDialog()">Reg</a> <button type="submit" class="btn btn-primary">Login</button></div></form></div></div>'),a.put("app/login/registration-form.html",'<form name="registrationForm" action="sink.html" target="sink" method="post" ng-submit="register(credentials)" novalidate=""><div class="form-group"><label for="username">Username:</label> <input class="form-control" type="text" id="username" autofocus="" ng-model="credentials.username" ng-required=""></div><div class="form-group"><label for="password">Password:</label> <input class="form-control" type="password" id="password" ng-model="credentials.password" ng-required=""></div><div class="form-group"><label for="password2">Password repeat:</label> <input class="form-control" type="password" id="password2" ng-model="credentials.password2" ng-required=""></div><button type="submit" class="btn btn-primary">Register</button></form><iframe src="/sink.html" name="sink" style="display:none"></iframe>'),a.put("app/pages/home.html",'<section class="section container-fluid"><h1 class="page-header">Welcome to Jógaadminisztátor</h1></section>'),a.put("app/pages/register.html",'<section class="section container-fluid"><h1 class="page-header">Regiszter</h1><bk-registration-form></bk-registration-form></section>'),a.put("app/pages/sidebar.html",'<h1 class="app-name">Jógaadminisztátor</h1><div class="scrollable"><h1 class="scrollable-header app-name">Jógaadminisztátor</h1><div class="scrollable-content"><div class="list-group" ui-turn-off="uiSidebarLeft"><a class="list-group-item" href="/">Home <i class="fa fa-chevron-right pull-right"></i></a> <a class="list-group-item" href="#/alkalmak/uj">Új Alkalom <i class="fa fa-chevron-right pull-right"></i></a> <a class="list-group-item" href="#/alkalmak">Alkalmak <i class="fa fa-chevron-right pull-right"></i></a> <a class="list-group-item" href="#/jogasok">Jógázók <i class="fa fa-chevron-right pull-right"></i></a></div></div><div class="scrollable-footer"><div ng-if="currentUser">{{ currentUser.name }}</div><div ng-if="!currentUser">Log in</div></div></div>')}]);