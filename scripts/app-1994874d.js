"use strict";function nextHour(e){var a=moment();return void 0!==e&&a.add("minute",e),a.set("hour",a.get("hour")+1),a.set("minute",0),a.set("second",0),a.set("millisecond",0),a}function LoginController(e,a,o,t){e.credentials={username:"",password:""},e.login=function(e){t.login(e).then(function(e){a.$broadcast(o.loginSuccess),a.setCurrentUser(e)},function(){a.$broadcast(o.loginFailed)})},e.hideDialog=function(){e.visible=!1}}var BackendServiceURL="https://jogaadmin.herokuapp.com";angular.module("jalagatiJoga",["ngRoute","ngResource","mobile-angular-ui","restangular"]).config(["$routeProvider",function(e){e.when("/",{templateUrl:"app/pages/home.html"}).when("/register",{templateUrl:"app/pages/register.html",data:{"public":!0}}).when("/alkalmak/uj",{templateUrl:"app/alkalmak/uj-alkalom-form.html",controller:"UjAlkalomController"}).when("/alkalmak/:alkalomId",{templateUrl:"app/alkalmak/egy-alkalom.html",controller:"AlkalomController",reloadOnSearch:!1}).when("/alkalmak",{templateUrl:"app/alkalmak/lista-alkalmak.html",controller:"AlkalomListaController"}).when("/jogasok/:jogasId/alkalmak",{controller:"JogasAlkalmakController",templateUrl:"app/jogas/alkalmak.html"}).when("/jogasok/:jogasId/berlet",{controller:"BerletCtrl",templateUrl:"app/jogas/berlet.html"}).when("/jogasok/:jogasId",{controller:"JogasCtrl",templateUrl:"app/jogas/jogas-egy.html"}).when("/jogasok",{controller:"JogasokCtrl",templateUrl:"app/jogas/jogasok-lista.html"}).otherwise({redirectTo:"/"})}]).value("redirectToAfterLogin",{url:"/"}).run(["$rootScope","$http","$route","AUTH_EVENTS","AuthService",function(e,a,o,t,l){e.$on("$routeChangeStart",function(a,o){l.isAuthorized(o.data&&o.data.public)||(a.preventDefault(),e.$broadcast(l.isAuthenticated()?t.notAuthorized:t.notAuthenticated))}),e.$on(t.loginSuccess,function(){o.reload()})}]).config(["$httpProvider",function(e){e.interceptors.push(["$injector",function(e){return e.get("AuthInterceptor")}]),e.interceptors.push(function(){return{request:function(e){if(e.url){var a=e.url.split("/").splice(-1)[0];-1===a.indexOf(".")&&(e.url=BackendServiceURL+e.url)}return e}}})}]).factory("AuthInterceptor",["$rootScope","$q","AUTH_EVENTS",function(e,a,o){return{responseError:function(t){return e.$broadcast({401:o.notAuthenticated,403:o.notAuthorized,419:o.sessionTimeout,440:o.sessionTimeout}[t.status],t),a.reject(t)}}}]).factory("alertify",function(){return alertify}).factory("httpErrorHandler",["alertify",function(e){return function(a){try{e.error("Sikertelen mentés: "+a.data.validation.keys.join(", "))}catch(o){e.error("Sikertelen mentés")}}}]).controller("ApplicationController",["$scope","$rootScope","$window","USER_ROLES","AuthService",function(e,a,o,t,l){e.sidebarUrl="app/pages/sidebar.html",e.currentUser=null,e.userRoles=t,e.isAuthorized=l.isAuthorized,e.back=function(){o.history.back()},a.setCurrentUser=function(a){e.currentUser=a}}]),angular.module(["jalagatiJoga"]).value("jogatartok",["Lakshmi","Paci","Kupati","Parvati","Kecske","Gyík","Gopi","Pocok"]).value("varosok",["Budapest, Király utca","Szeged"]).factory("Alkalom",["$resource",function(e){var a=e("/alkalmak/:id/:action",{id:"@_id",action:"@action"},{addResztvevo:{method:"POST",params:{action:"addResztvevo",jogasId:!0}},removeResztvevo:{method:"POST",params:{action:"removeResztvevo",resztvevoId:!0}}});return a}]).factory("Resztvevo",["$resource",function(e){var a=e("/resztvevok/:id/:action",{id:"@_id",action:"@action"},{update:{method:"POST",params:{action:"update"}}});return a}]).controller("UjAlkalomController",["$scope","$location","Alkalom","jogatartok","varosok",function(e,a,o,t,l){var s=nextHour().toDate();e.jogatartok=t,e.varosok=l,e.ujAlkalom={tartja:null,segit:e.currentUser.name,date:s,time:s},e.setupAlkalom=function(e){e.starts=moment(e.date.toISOString().split("T")[0]+" "+e.time.toLocaleTimeString()).toDate(),e=new o(e),e.$save(function(e){a.path("/alkalmak/"+e._id)})}}]).controller("AlkalomListaController",["$scope","Alkalom","varosok",function(e,a,o){e.varosok=o,e.location="",e.alkalmak=a.query()}]).controller("AlkalomController",["$scope","$routeParams","$window","Jogas","alertify","$location","Alkalom","Resztvevo","varosok","SharedState","httpErrorHandler",function(e,a,o,t,l,s,r,i,n,c,d){e.alkalom=r.get({id:a.alkalomId}),e.jogasok=t.query(),e.varosok=n,c.initialize(e,"editResztvevo",!1),e.addJogas=function(a){s.search("next",s.path()),s.search("name",a),s.search("city",e.alkalom.location),s.path("/jogasok")},e.addResztvevo=function(e,a){a.$addResztvevo({jogasId:e._id}).catch(d)},e.removeResztvevo=function(e,a){a.$removeResztvevo({resztvevoId:e.resztvevo}).catch(d)},e.editResztvevo=function(a){e.resztvevo=i.get({id:a})},e.updateResztvevo=function(e){var a={};angular.forEach(["szamla","torulkozo","kupon","note","fizetett"],function(o){a[o]=e[o]}),e.$update(a).then(function(){l.success("Módosítások elmentve"),c.turnOff("editResztvevo")},d)}}]),angular.module(["jalagatiJoga"]).factory("Jogas",["$resource",function(e){var a=e("/jogasok/:id/:action",{id:"@_id",action:"@action"},{ujBerlet:{method:"POST",params:{action:"ujberlet"}}});return a}]).controller("JogasokCtrl",["$scope","$location","Jogas","varosok","alertify","httpErrorHandler",function(e,a,o,t,l,s){e.jogasok=o.query(),e.varosok=t,e.search=e.location="",e.jogas={name:a.search().name,city:a.search().city},e.addJogas=function(e){var t=new o(e);t.$save(function(e){l.success("Módosítások elmentve"),a.path(a.search().next?a.search().next:"/jogasok/"+e._id)},s)}}]).controller("JogasCtrl",["$scope","$routeParams","Jogas","varosok","alertify","httpErrorHandler",function(e,a,o,t,l,s){e.jogas=o.get({id:a.jogasId}),e.varosok=t,e.save=function(){e.jogas.$save({},function(){l.success("Módosítások elmentve"),e.back()},s)}}]).controller("BerletCtrl",["$scope","$routeParams","Jogas","alertify","httpErrorHandler",function(e,a,o,t,l){e.jogas=o.get({id:a.jogasId}),e.save=function(a){e.jogas.$ujBerlet(a,function(){t.success("Módosítások elmentve"),e.back()},l)}}]).controller("JogasAlkalmakController",["$scope","$routeParams","Jogas",function(e,a,o){e.jogas=o.get({id:a.jogasId})}]),angular.module("jalagatiJoga").service("Session",["$http",function(e){return this.create=function(a,o,t){this.id=a,this.name=o,this.token=t,e.defaults.headers.common.Authorization="Bearer "+t},this.destroy=function(){this.id=null,this.name=null,this.token=null,e.defaults.headers.common.Authorization=""},this}]).factory("AuthService",["$http","Session","alertify",function(e,a,o){var t={};return t.login=function(t){return e.post("/auth/login",t).then(function(e){return a.create(e.data.id,e.data.name,e.data.token),e.data},function(){o.error("Hibás bejelentkezés")})},t.register=function(t){return e.post("/auth/signup",t).then(function(e){return o.success("Sikeres regisztrálás"),a.create(e.data.id,e.data.name,e.data.token),e.data},function(){o.error("Hibás regisztrálás")})},t.isAuthenticated=function(){return!!a.id},t.isAuthorized=function(e){return e||!!a.id},t}]),LoginController.$inject=["$scope","$rootScope","AUTH_EVENTS","AuthService"],angular.module(["jalagatiJoga"]).directive("loginDialog",["AUTH_EVENTS",function(e){return{restrict:"A",scope:{setCurrentUser:"&"},template:'<div ng-if="visible" ng-include="\'app/login/login-form.html\'">',link:function(a){var o=function(){a.visible=!0},t=function(){a.visible=!1};a.visible=!1,a.$on(e.notAuthenticated,o),a.$on(e.sessionTimeout,o),a.$on(e.loginSuccess,t)},controller:LoginController}}]).directive("formAutofillFix",["$timeout",function(e){return function(a,o,t){o.prop("method","post"),t.ngSubmit&&e(function(){o.unbind("submit").bind("submit",function(e){e.preventDefault(),o.find("input, textarea, select").trigger("input").trigger("change").trigger("keydown"),a.$apply(t.ngSubmit)})})}}]),angular.module("jalagatiJoga").constant("AUTH_EVENTS",{loginSuccess:"auth-login-success",loginFailed:"auth-login-failed",logoutSuccess:"auth-logout-success",sessionTimeout:"auth-session-timeout",notAuthenticated:"auth-not-authenticated",notAuthorized:"auth-not-authorized"}).constant("USER_ROLES",{all:"*",admin:"admin",guest:"guest"}),angular.module(["jalagatiJoga"]).directive("bkRegistrationForm",["AUTH_EVENTS",function(e){return{restrict:"E",scope:{setCurrentUser:"&"},templateUrl:"app/login/registration-form.html",controller:["$scope","$rootScope","AuthService",function(a,o,t){a.credentials={username:"",password:"",password2:""},a.register=function(l){t.register(l).then(function(t){o.$broadcast(e.loginSuccess),a.setCurrentUser(t)},function(){o.$broadcast(e.loginFailed)})}}]}}]),angular.module("jalagatiJoga").run(["$templateCache",function(e){e.put("app/alkalmak/egy-alkalom.html",'<section class="section container-fluid"><div class="row"><h2>{{alkalom.starts | date:\'medium\' }} - {{alkalom.location}} / {{alkalom.tartja}}</h2><div class="col-xs-12"><form class="form-inline"><div class="form-group col-xs-4"><label for="filter" class="sr-only">Szűrés</label> <input id="filter" class="form-control" type="text" autofocus="" ng-model="search"></div><div class="form-group col-xs-4"><label for="varos-filter" class="sr-only">Városok</label><select id="varos-filter" class="form-control" ng-model="location" ng-options="l for l in varosok"><option value="">--</option></select></div><div class="form-group col-xs-4"><button ng-click="addJogas(search)" ng-show="search" class="btn btn-primary">Új jógázó</button></div></form></div><ul class="col-xs-6 list-group"><li class="list-group-item clearfix" ng-repeat="jogas in jogasok | filter:location | filter:search | orderBy:name"><div class="list-group-text">{{jogas.name}}</div><div class="pull-right"><a ng-click="addResztvevo(jogas, alkalom)" class="btn btn-primary"><i class="fa fa-check"></i>Választ</a> <a ng-href="#/jogasok/{{jogas._id}}/berlet" class="btn btn-default"><i class="fa fa-star-half"></i>Bérletek</a></div></li></ul><div class="col-xs-6"><h3>Résztvevők:</h3><ul class="list-group"><li class="list-group-item clearfix" ng-repeat="resztvevo in alkalom.resztvevok | orderBy:name"><div class="list-group-text">{{resztvevo.name}}</div><div class="pull-right"><button class="btn btn-default" ui-turn-on="editResztvevo" ng-click="editResztvevo(resztvevo.resztvevo)"><i class="fa fa-pencil-square-o"></i></button> <button ng-click="removeResztvevo(resztvevo, alkalom)" class="btn btn-warning"><i class="fa fa-times"></i></button></div></li></ul></div></div><div ui-content-for="modals"><div class="modal modal-overlay" ui-if="editResztvevo" ui-state="editResztvevo"><div class="modal-dialog"><form class="modal-content" name="editResztvevoForm" role="form" ng-submit="updateResztvevo(resztvevo)"><div class="modal-header"><button class="close" ui-turn-off="editResztvevo">&times;</button><h4 class="modal-title">Résztvevő szerkesztése: {{resztvevo.jogas.name}}</h4></div><div class="modal-body"><div class="checkbox disabled"><label><input type="checkbox" ng-model="resztvevo.berlet" disabled=""> Bérlet</label></div><div ng-class="{ error: editResztvevoForm.torulkozo.$invalid }"><div class="checkbox"><label><input type="checkbox" name="torulkozo" ng-model="resztvevo.torulkozo"> Törülköző</label></div></div><div ng-class="{ error: editResztvevoForm.szamla.$invalid }"><div class="checkbox"><label><input type="checkbox" name="szamla" ng-model="resztvevo.szamla"> Számla</label></div></div><div ng-class="{ error: editResztvevoForm.kupon.$invalid }"><div class="checkbox"><label><input type="checkbox" name="kupon" ng-model="resztvevo.kupon"> Kupon</label></div></div><div class="form-group" ng-class="{ error: editResztvevoForm.fizetett.$invalid }"><label for="fizetett">Összeg</label> <input id="fizetett" name="fizetett" class="form-control" ng-model="resztvevo.fizetett" type="number"></div><div class="form-group" ng-class="{ error: editResztvevoForm.note.$invalid }"><label for="note">Megjegyzés</label> <textarea id="note" name="note" class="form-control" ng-model="resztvevo.note"></textarea></div></div><div class="modal-footer"><button ui-turn-off="editResztvevo" class="btn btn-default">Close</button> <button type="submit" class="btn btn-primary">Save changes</button></div></form></div></div></div></section>'),e.put("app/alkalmak/lista-alkalmak.html",'<section class="section container-fluid"><h1 class="page-header">Alkalmak<select id="varos-filter" class="pull-right" ng-model="location" ng-options="l for l in varosok"><option value="">--</option></select></h1><div ng-repeat="alkalom in alkalmak | filter:location | orderBy:starts" class="list-group"><a class="list-group-item" ng-href="#/alkalmak/{{alkalom._id}}">{{alkalom.tartja}}, {{alkalom.location}}, {{alkalom.starts | date:\'medium\'}} <i class="fa fa-chevron-right pull-right"></i></a></div></section>'),e.put("app/alkalmak/uj-alkalom-form.html",'<section class="section container-fluid"><h2>Új alkalom indítása</h2><form name="addAlkalomForm" role="form" ng-submit="setupAlkalom(ujAlkalom)"><div class="form-group"><label for="jogatarto">Jógatartó</label><select id="jogatarto" name="tartja" class="form-control" autofocus="" ng-model="ujAlkalom.tartja" ng-required="true" ng-options="j for j in jogatartok"></select></div><div class="form-group"><label for="segito">Segítő</label> <input id="segito" name="segit" type="text" placeholder="Segítő" class="form-control" ng-model="ujAlkalom.segit"></div><div class="form-group"><label for="helyszin">Helyszín</label><select id="helyszin" name="location" class="form-control" ng-model="ujAlkalom.location" ng-required="true" ng-options="l for l in varosok"></select></div><div class="form-group"><label for="datum">Dátum</label> <input id="datum" name="starts" type="date" class="form-control" ng-model="ujAlkalom.date" required="required"> <input id="idopont" type="time" placeholder="Időpont" class="form-control" ng-model="ujAlkalom.time" required="required"></div><button type="submit" class="btn btn-primary">Mehet</button> <a ng-href="#/alkalmak">Alkalmak</a></form></section>'),e.put("app/jogas/alkalmak.html",'<section class="section container-fluid"><div class="row"><h1>Mikor járt nálunk {{jogas.name}}?</h1><ul class="col-xs-12"><li ng-repeat="alkalom in jogas.alkalmak"><a ng-href="#/alkalmak/{{alkalom.alkalom}}">{{alkalom.date}}</a></li></ul></div></section>'),e.put("app/jogas/berlet.html",'<section class="section container-fluid"><h1>{{jogas.name}} bérletei</h1><h2>Új bérlet</h2><form role="form"><div class="form-group"><label>Alkalmak száma: <input type="number" ng-model="berlet.alkalmak" value="0" autofocus=""></label></div><div class="form-group"><label>Kezdő dátum: <input type="date" ng-model="berlet.startDate"></label></div><div class="form-group"><label>Záró dátum<input type="date" ng-model="berlet.endDate"></label></div><div class="form-group"><button class="btn btn-primary" ng-click="save(berlet)">Ok</button> <a ng-click="back()">Mégse</a></div></form><h2>Korábbi bérletei</h2><ul><li ng-repeat="berlet in jogas.berletek"><div ng-show="{{berlet.alkalmak}}">Alkalmak: {{berlet.alkalmak}}</div><div>Időszak: {{berlet.startDate | date }}-{{berlet.endDate | date }}</div><div>Felhasználva: {{berlet.felhasznalva.length}}</div></li></ul></section>'),e.put("app/jogas/jogas-egy.html",'<section class="section container-fluid"><h1>{{jogas.name}} adatai</h1><form name="editJogasForm" role="form"><div class="form-group"><label for="jogas-name">Név</label> <input id="jogas-name" name="name" class="form-control" type="text" value="{{jogas.name}}" ng-model="jogas.name" ng-required="true"></div><div class="form-group"><label for="jogas-nick">Becenév</label> <input id="jogas-nick" name="nick" class="form-control" type="text" value="{{jogas.nick}}" ng-model="jogas.nick"></div><div class="form-group"><label for="jogas-email">E-mail</label> <input id="jogas-email" name="email" class="form-control" type="text" value="{{jogas.email}}" ng-model="jogas.email"></div><div class="form-group"><label for="jogas-city">Város:</label><select id="jogas-city" name="city" class="form-control" ng-model="jogas.city" ng-options="l for l in varosok" ng-required="true"></select></div><div class="form-group"><label for="jogas-note">Egyéb:</label> <textarea id="jogas-note" name="note" class="form-control" ng-model="jogas.note" placeholder="Hogyan talált ide? Van-e valami sérülése?"></textarea></div><button class="btn btn-primary" ng-click="save(jogas)">Ment</button> <button type="reset" class="btn btn-warning">Mégse</button> <a ng-href="#/jogasok/{{jogas._id}}/berlet" class="btn">Bérletek</a> <a href="#/jogasok/{{jogas._id}}/alkalmak" class="btn">Történet</a></form></section>'),e.put("app/jogas/jogasok-lista.html",'<section class="section container-fluid"><div class="row"><div class="col-xs-6"><h3>Jógázók</h3><div class="col-xs-12"><form class="form-inline"><div class="form-group col-xs-6"><label for="filter" class="sr-only">Szűrés</label> <input id="filter" class="form-control" type="text" autofocus="" ng-model="search"></div><div class="form-group col-xs-6"><label for="varos-filter" class="sr-only">Városok</label><select id="varos-filter" class="form-control" ng-model="location" ng-options="l for l in varosok"><option value="">--</option></select></div></form></div><ul class="col-xs-12 list-group"><li class="list-group-item clearfix" ng-repeat="jogas in jogasok | filter: location | filter:search | orderBy:name"><div class="list-group-item-text">{{jogas.name}} <span ng-if="jogas.nick">({{jogas.nick}})</span></div><div class="pull-right"><a ng-href="#/jogasok/{{jogas._id}}" class="btn btn-default"><i class="fa fa-user"></i> Adatok</a> <a ng-href="#/jogasok/{{jogas._id}}/berlet" class="btn btn-default"><i class="fa fa-star-half"></i>Bérletek</a> <a href="#/jogasok/{{jogas._id}}/alkalmak" class="btn btn-default"><i class="fa fa-calendar"></i>Történet</a></div></li></ul></div><div class="col-xs-6"><h3>Új jógázó</h3><form name="addJogasForm" role="form" ng-submit="addJogas(jogas)" ng-hide="search"><div class="form-group"><label for="jogas-name">Név</label> <input id="jogas-name" name="name" class="form-control" type="text" value="{{jogas.name}}" ng-model="jogas.name" ng-required="true"></div><div class="form-group"><label for="jogas-nick">Becenév</label> <input id="jogas-nick" name="nick" class="form-control" type="text" value="{{jogas.nick}}" ng-model="jogas.nick"></div><div class="form-group"><label for="jogas-email">E-mail</label> <input id="jogas-email" name="email" class="form-control" type="text" value="{{jogas.email}}" ng-model="jogas.email"></div><div class="form-group"><label for="jogas-city">Város:</label><select id="jogas-city" name="city" class="form-control" ng-model="jogas.city" ng-options="l for l in varosok" ng-required="true"></select></div><div class="form-group"><label for="jogas-note">Egyéb:</label> <textarea id="jogas-note" name="note" class="form-control" ng-model="jogas.note" placeholder="Hogyan talált ide? Van-e valami sérülése?"></textarea></div><button type="submit" class="btn btn-primary">Add</button></form></div></div></section>'),e.put("app/login/login-form.html",'<div class="modal"><div class="modal-backdrop in"></div><div class="modal-dialog"><form class="modal-content" name="loginForm" action="sink.html" target="sink" method="post" ng-submit="login(credentials)" novalidate="" form-autofill-fix=""><div class="modal-header"><h4 class="modal-title">Bejelentkezés</h4></div><div class="modal-body"><div class="form-group"><label for="username">Username:</label> <input class="form-control" type="text" id="username" autofocus="" ng-model="credentials.username" ng-required=""></div><div class="form-group"><label for="password">Password:</label> <input class="form-control" type="password" id="password" ng-model="credentials.password" ng-required=""></div></div><div class="modal-footer"><a class="btn" ng-href="#/register" ng-click="hideDialog()">Reg</a> <button type="submit" class="btn btn-primary">Login</button></div></form></div></div>'),e.put("app/login/registration-form.html",'<form name="registrationForm" action="sink.html" target="sink" method="post" ng-submit="register(credentials)" novalidate=""><div class="form-group"><label for="username">Username:</label> <input class="form-control" type="text" id="username" name="username" autofocus="" ng-model="credentials.username" ng-required=""></div><div class="form-group"><label for="password">Password:</label> <input class="form-control" type="password" id="password" name="password" ng-model="credentials.password" ng-required=""></div><div class="form-group"><label for="password2">Password repeat:</label> <input class="form-control" type="password" id="password2" name="password2" ng-model="credentials.password2" ng-required=""></div><button type="submit" class="btn btn-primary">Register</button></form>'),e.put("app/pages/home.html",'<section class="section container-fluid"><h1 class="page-header">Welcome to Jógaadminisztátor</h1></section>'),e.put("app/pages/register.html",'<section class="section container-fluid"><h1 class="page-header">Regiszter</h1><bk-registration-form></bk-registration-form></section>'),e.put("app/pages/sidebar.html",'<h1 class="app-name">Jógaadminisztátor</h1><div class="scrollable"><h1 class="scrollable-header app-name">Jógaadminisztátor</h1><div class="scrollable-content"><div class="list-group" ui-turn-off="uiSidebarLeft"><a class="list-group-item" href="/">Home <i class="fa fa-chevron-right pull-right"></i></a> <a class="list-group-item" href="#/alkalmak/uj">Új Alkalom <i class="fa fa-chevron-right pull-right"></i></a> <a class="list-group-item" href="#/alkalmak">Alkalmak <i class="fa fa-chevron-right pull-right"></i></a> <a class="list-group-item" href="#/jogasok">Jógázók <i class="fa fa-chevron-right pull-right"></i></a></div></div><div class="scrollable-footer"><div ng-if="currentUser">{{ currentUser.name }}</div><div ng-if="!currentUser">Log in</div></div></div>')}]);