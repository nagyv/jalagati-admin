"use strict";function nextHour(a){var e=moment();return void 0!==a&&e.add("minute",a),e.set("hour",e.get("hour")+1),e.set("minute",0),e.set("second",0),e.set("millisecond",0),e}function LoginController(a,e,o,t){a.credentials={username:"",password:""},a.login=function(a){t.login(a).then(function(a){e.$broadcast(o.loginSuccess),e.setCurrentUser(a)},function(){e.$broadcast(o.loginFailed)})},a.hideDialog=function(){a.visible=!1}}var BackendServiceURL="https://jogaadmin.herokuapp.com";angular.module("jalagatiJoga",["ngRoute","ngResource","mobile-angular-ui","restangular"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"app/pages/home.html"}).when("/register",{templateUrl:"app/pages/register.html",data:{"public":!0}}).when("/alkalmak/uj",{templateUrl:"app/alkalmak/uj-alkalom-form.html",controller:"UjAlkalomController"}).when("/alkalmak/:alkalomId",{templateUrl:"app/alkalmak/egy-alkalom.html",controller:"AlkalomController",reloadOnSearch:!1}).when("/alkalmak",{templateUrl:"app/alkalmak/lista-alkalmak.html",controller:"AlkalomListaController"}).when("/jogasok/:jogasId/alkalmak",{controller:"JogasAlkalmakController",templateUrl:"app/jogas/alkalmak.html"}).when("/jogasok/:jogasId/berlet",{controller:"BerletCtrl",templateUrl:"app/jogas/berlet.html"}).when("/jogasok/:jogasId",{controller:"JogasCtrl",templateUrl:"app/jogas/jogas-egy.html"}).when("/jogasok",{controller:"JogasokCtrl",templateUrl:"app/jogas/jogasok-lista.html"}).otherwise({redirectTo:"/"})}]).value("redirectToAfterLogin",{url:"/"}).run(["$rootScope","$http","$route","AUTH_EVENTS","AuthService",function(a,e,o,t,l){a.$on("$routeChangeStart",function(e,o){l.isAuthorized(o.data&&o.data.public)||(e.preventDefault(),a.$broadcast(l.isAuthenticated()?t.notAuthorized:t.notAuthenticated))}),a.$on(t.loginSuccess,function(){o.reload()})}]).config(["$httpProvider",function(a){a.interceptors.push(["$injector",function(a){return a.get("AuthInterceptor")}]),a.interceptors.push(function(){return{request:function(a){if(a.url){var e=a.url.split("/").splice(-1)[0];-1===e.indexOf(".")&&(a.url=BackendServiceURL+a.url)}return a}}})}]).factory("AuthInterceptor",["$rootScope","$q","AUTH_EVENTS",function(a,e,o){return{responseError:function(t){return a.$broadcast({401:o.notAuthenticated,403:o.notAuthorized,419:o.sessionTimeout,440:o.sessionTimeout}[t.status],t),e.reject(t)}}}]).factory("alertify",function(){return alertify}).controller("ApplicationController",["$scope","$rootScope","$window","USER_ROLES","AuthService",function(a,e,o,t,l){a.sidebarUrl="app/pages/sidebar.html",a.currentUser=null,a.userRoles=t,a.isAuthorized=l.isAuthorized,a.back=function(){o.history.back()},e.setCurrentUser=function(e){a.currentUser=e}}]),angular.module(["jalagatiJoga"]).value("jogatartok",["Lakshmi","Paci","Kupati","Parvati","Kecske","Gyík","Gopi","Pocok"]).value("varosok",["Budapest, Király utca","Szeged"]).factory("Alkalom",["$resource",function(a){var e=a("/alkalmak/:id/:action",{id:"@_id",action:"@action"},{addResztvevo:{method:"POST",params:{action:"addResztvevo",jogasId:!0}},removeResztvevo:{method:"POST",params:{action:"removeResztvevo",resztvevoId:!0}}});return e}]).factory("Resztvevo",["$resource",function(a){var e=a("/resztvevok/:id/:action",{id:"@_id",action:"@action"},{update:{method:"POST",params:{action:"update"}}});return e}]).controller("UjAlkalomController",["$scope","$location","Alkalom","jogatartok","varosok",function(a,e,o,t,l){var s=nextHour().toDate();a.jogatartok=t,a.varosok=l,a.ujAlkalom={tartja:null,segit:a.currentUser.name,date:s,time:s},a.setupAlkalom=function(a){a.starts=moment(a.date.toISOString().split("T")[0]+" "+a.time.toLocaleTimeString()).toDate(),a=new o(a),a.$save(function(a){e.path("/alkalmak/"+a._id)})}}]).controller("AlkalomListaController",["$scope","Alkalom","varosok",function(a,e,o){a.varosok=o,a.location="",a.alkalmak=e.query()}]).controller("AlkalomController",["$scope","$routeParams","$window","Jogas","alertify","$location","Alkalom","Resztvevo","varosok","SharedState",function(a,e,o,t,l,s,r,i,n,c){a.alkalom=r.get({id:e.alkalomId}),a.jogasok=t.query(),a.varosok=n,c.initialize(a,"editResztvevo",!1),a.addJogas=function(e){s.search("next",s.path()),s.search("name",e),s.search("city",a.alkalom.location),s.path("/jogasok")},a.addResztvevo=function(a,e){e.$addResztvevo({jogasId:a._id})},a.removeResztvevo=function(a,e){e.$removeResztvevo({resztvevoId:a.resztvevo})},a.editResztvevo=function(e){a.resztvevo=i.get({id:e})},a.updateResztvevo=function(a){var e={};angular.forEach(["szamla","torulkozo","kupon","note","fizetett"],function(o){e[o]=a[o]}),a.$update(e).then(function(){l.success("Módosítások elmentve"),c.turnOff("editResztvevo")})}}]),angular.module(["jalagatiJoga"]).factory("Jogas",["$resource",function(a){var e=a("/jogasok/:id/:action",{id:"@_id",action:"@action"},{ujBerlet:{method:"POST",params:{action:"ujberlet"}}});return e}]).controller("JogasokCtrl",["$scope","$location","Jogas","varosok","alertify",function(a,e,o,t,l){a.jogasok=o.query(),a.varosok=t,a.search=a.location="",a.jogas={name:e.search().name,city:e.search().city},a.addJogas=function(a){var t=new o(a);t.$save(function(a){l.success("Módosítások elmentve"),e.path(e.search().next?e.search().next:"/jogasok/"+a._id)})}}]).controller("JogasCtrl",["$scope","$routeParams","Jogas","varosok","alertify",function(a,e,o,t,l){a.jogas=o.get({id:e.jogasId}),a.varosok=t,a.save=function(){a.jogas.$save({},function(){l.success("Módosítások elmentve"),a.back()})}}]).controller("BerletCtrl",["$scope","$routeParams","Jogas","alertify",function(a,e,o,t){a.jogas=o.get({id:e.jogasId}),a.$window=$window,a.save=function(e){a.jogas.$ujBerlet(e,function(){t.success("Módosítások elmentve"),a.back()})}}]).controller("JogasAlkalmakController",["$scope","$routeParams","Jogas",function(a,e,o){a.jogas=o.get({id:e.jogasId})}]),angular.module("jalagatiJoga").service("Session",["$http",function(a){return this.create=function(e,o,t){this.id=e,this.name=o,this.token=t,a.defaults.headers.common.Authorization="Bearer "+t},this.destroy=function(){this.id=null,this.name=null,this.token=null,a.defaults.headers.common.Authorization=""},this}]).factory("AuthService",["$http","Session","alertify",function(a,e,o){var t={};return t.login=function(t){return a.post("/auth/login",t).then(function(a){return e.create(a.data.id,a.data.name,a.data.token),a.data},function(){o.error("Hibás bejelentkezés")})},t.register=function(t){return a.post("/auth/signup",t).then(function(a){return o.success("Sikeres regisztrálás"),e.create(a.data.id,a.data.name,a.data.token),a.data},function(){o.error("Hibás regisztrálás")})},t.isAuthenticated=function(){return!!e.id},t.isAuthorized=function(a){return a||!!e.id},t}]),LoginController.$inject=["$scope","$rootScope","AUTH_EVENTS","AuthService"],angular.module(["jalagatiJoga"]).directive("loginDialog",["AUTH_EVENTS",function(a){return{restrict:"A",scope:{setCurrentUser:"&"},template:'<div ng-if="visible" ng-include="\'app/login/login-form.html\'">',link:function(e){var o=function(){e.visible=!0},t=function(){e.visible=!1};e.visible=!1,e.$on(a.notAuthenticated,o),e.$on(a.sessionTimeout,o),e.$on(a.loginSuccess,t)},controller:LoginController}}]).directive("formAutofillFix",["$timeout",function(a){return function(e,o,t){o.prop("method","post"),t.ngSubmit&&a(function(){o.unbind("submit").bind("submit",function(a){a.preventDefault(),o.find("input, textarea, select").trigger("input").trigger("change").trigger("keydown"),e.$apply(t.ngSubmit)})})}}]),angular.module("jalagatiJoga").constant("AUTH_EVENTS",{loginSuccess:"auth-login-success",loginFailed:"auth-login-failed",logoutSuccess:"auth-logout-success",sessionTimeout:"auth-session-timeout",notAuthenticated:"auth-not-authenticated",notAuthorized:"auth-not-authorized"}).constant("USER_ROLES",{all:"*",admin:"admin",guest:"guest"}),angular.module(["jalagatiJoga"]).directive("bkRegistrationForm",["AUTH_EVENTS",function(a){return{restrict:"E",scope:{setCurrentUser:"&"},templateUrl:"app/login/registration-form.html",controller:["$scope","$rootScope","AuthService","alertify",function(e,o,t){e.credentials={username:"",password:"",password2:""},e.register=function(l){t.register(l).then(function(t){o.$broadcast(a.loginSuccess),e.setCurrentUser(t)},function(){o.$broadcast(a.loginFailed)})}}]}}]),angular.module("jalagatiJoga").run(["$templateCache",function(a){a.put("app/alkalmak/egy-alkalom.html",'<section class="section container-fluid"><div class="row"><h2>{{alkalom.starts | date:\'medium\' }} - {{alkalom.location}} / {{alkalom.tartja}}</h2><div class="col-xs-12"><form class="form-inline"><div class="form-group col-xs-4"><label for="filter" class="sr-only">Szűrés</label> <input id="filter" class="form-control" type="text" autofocus="" ng-model="search"></div><div class="form-group col-xs-4"><label for="varos-filter" class="sr-only">Városok</label><select id="varos-filter" class="form-control" ng-model="location" ng-options="l for l in varosok"><option value="">--</option></select></div><div class="form-group col-xs-4"><button ng-click="addJogas(search)" ng-show="search" class="btn btn-primary">Új jógázó</button></div></form></div><ul class="col-xs-6 list-group"><li class="list-group-item clearfix" ng-repeat="jogas in jogasok | filter:location | filter:search | orderBy:name"><div class="list-group-text">{{jogas.name}}</div><div class="pull-right"><a ng-click="addResztvevo(jogas, alkalom)" class="btn btn-primary"><i class="fa fa-check"></i>Választ</a> <a ng-href="#/jogasok/{{jogas._id}}/berlet" class="btn btn-default"><i class="fa fa-star-half"></i>Bérletek</a></div></li></ul><div class="col-xs-6"><h3>Résztvevők:</h3><ul class="list-group"><li class="list-group-item clearfix" ng-repeat="resztvevo in alkalom.resztvevok | orderBy:name"><div class="list-group-text">{{resztvevo.name}}</div><div class="pull-right"><button class="btn btn-default" ui-turn-on="editResztvevo" ng-click="editResztvevo(resztvevo.resztvevo)"><i class="fa fa-pencil-square-o"></i></button> <button ng-click="removeResztvevo(resztvevo, alkalom)" class="btn btn-warning"><i class="fa fa-times"></i></button></div></li></ul></div></div><div ui-content-for="modals"><div class="modal modal-overlay" ui-if="editResztvevo" ui-state="editResztvevo"><div class="modal-dialog"><form class="modal-content" role="form" ng-submit="updateResztvevo(resztvevo)"><div class="modal-header"><button class="close" ui-turn-off="editResztvevo">&times;</button><h4 class="modal-title">Résztvevő szerkesztése: {{resztvevo.jogas.name}}</h4></div><div class="modal-body"><div class="checkbox disabled"><label><input type="checkbox" ng-model="resztvevo.berlet" disabled=""> Bérlet</label></div><div class="checkbox"><label><input type="checkbox" ng-model="resztvevo.torulkozo"> Törülköző</label></div><div class="checkbox"><label><input type="checkbox" ng-model="resztvevo.szamla"> Számla</label></div><div class="checkbox"><label><input type="checkbox" ng-model="resztvevo.kupon"> Kupon</label></div><div class="form-group"><label for="fizetett">Összeg</label> <input id="fizetett" class="form-control" ng-model="resztvevo.fizetett" type="number"></div><div class="form-group"><label for="note">Megjegyzés</label> <textarea id="note" class="form-control" ng-model="resztvevo.note"></textarea></div></div><div class="modal-footer"><button ui-turn-off="editResztvevo" class="btn btn-default">Close</button> <button type="submit" class="btn btn-primary">Save changes</button></div></form></div></div></div></section>'),a.put("app/alkalmak/lista-alkalmak.html",'<section class="section container-fluid"><h1 class="page-header">Alkalmak<select id="varos-filter" class="pull-right" ng-model="location" ng-options="l for l in varosok"><option value="">--</option></select></h1><div ng-repeat="alkalom in alkalmak | filter:location | orderBy:starts" class="list-group"><a class="list-group-item" ng-href="#/alkalmak/{{alkalom._id}}">{{alkalom.tartja}}, {{alkalom.location}}, {{alkalom.starts | date:\'medium\'}} <i class="fa fa-chevron-right pull-right"></i></a></div></section>'),a.put("app/alkalmak/uj-alkalom-form.html",'<section class="section container-fluid"><h2>Új alkalom indítása</h2><form role="form" ng-submit="setupAlkalom(ujAlkalom)"><div class="form-group"><label for="jogatarto">Jógatartó</label><select id="jogatarto" class="form-control" autofocus="" ng-model="ujAlkalom.tartja" ng-required="true" ng-options="j for j in jogatartok"></select></div><div class="form-group"><label for="segito">Segítő</label> <input id="segito" type="text" placeholder="Segítő" class="form-control" ng-model="ujAlkalom.segit"></div><div class="form-group"><label for="helyszin">Helyszín</label><select id="helyszin" class="form-control" ng-model="ujAlkalom.location" ng-required="true" ng-options="l for l in varosok"></select></div><div class="form-group"><label for="datum">Dátum</label> <input id="datum" type="date" class="form-control" ng-model="ujAlkalom.date" required="required"> <input id="idopont" type="time" placeholder="Időpont" class="form-control" ng-model="ujAlkalom.time" required="required"></div><button type="submit" class="btn btn-primary">Mehet</button> <a ng-href="#/alkalmak">Alkalmak</a></form></section>'),a.put("app/jogas/alkalmak.html",'<section class="section container-fluid"><div class="row"><h1>Mikor járt nálunk {{jogas.name}}?</h1><ul class="col-xs-12"><li ng-repeat="alkalom in jogas.alkalmak"><a ng-href="#/alkalmak/{{alkalom.alkalom}}">{{alkalom.date}}</a></li></ul></div></section>'),a.put("app/jogas/berlet.html",'<section class="section container-fluid"><h1>{{jogas.name}} bérletei</h1><h2>Új bérlet</h2><form role="form"><div class="form-group"><label>Alkalmak száma: <input type="number" ng-model="berlet.alkalmak" value="0" autofocus=""></label></div><div class="form-group"><label>Kezdő dátum: <input type="date" ng-model="berlet.startDate"></label></div><div class="form-group"><label>Záró dátum<input type="date" ng-model="berlet.endDate"></label></div><div class="form-group"><button class="btn btn-primary" ng-click="save(berlet)">Ok</button> <a ng-click="back()">Mégse</a></div></form><h2>Korábbi bérletei</h2><ul><li ng-repeat="berlet in jogas.berletek"><div ng-show="{{berlet.alkalmak}}">Alkalmak: {{berlet.alkalmak}}</div><div>Időszak: {{berlet.startDate | date }}-{{berlet.endDate | date }}</div><div>Felhasználva: {{berlet.felhasznalva.length}}</div></li></ul></section>'),a.put("app/jogas/jogas-egy.html",'<section class="section container-fluid"><h1>{{jogas.name}} adatai</h1><form role="form"><div class="form-group"><label for="jogas-name">Név</label> <input id="jogas-name" class="form-control" type="text" value="{{jogas.name}}" ng-model="jogas.name" ng-required="true"></div><div class="form-group"><label for="jogas-nick">Becenév</label> <input id="jogas-nick" class="form-control" type="text" value="{{jogas.nick}}" ng-model="jogas.nick"></div><div class="form-group"><label for="jogas-email">E-mail</label> <input id="jogas-email" class="form-control" type="text" value="{{jogas.email}}" ng-model="jogas.email"></div><div class="form-group"><label for="jogas-city">Város:</label><select id="jogas-city" class="form-control" ng-model="jogas.city" ng-options="l for l in varosok" ng-required="true"></select></div><div class="form-group"><label for="jogas-note">Egyéb:</label> <textarea id="jogas-note" class="form-control" ng-model="jogas.note" placeholder="Hogyan talált ide? Van-e valami sérülése?"></textarea></div><button class="btn btn-primary" ng-click="save(jogas)">Ment</button> <button type="reset" class="btn btn-warning">Mégse</button> <a ng-href="#/jogasok/{{jogas._id}}/berlet" class="btn">Bérletek</a> <a href="#/jogasok/{{jogas._id}}/alkalmak" class="btn">Történet</a></form></section>'),a.put("app/jogas/jogasok-lista.html",'<section class="section container-fluid"><div class="row"><div class="col-xs-6"><h3>Jógázók</h3><div class="col-xs-12"><form class="form-inline"><div class="form-group col-xs-6"><label for="filter" class="sr-only">Szűrés</label> <input id="filter" class="form-control" type="text" autofocus="" ng-model="search"></div><div class="form-group col-xs-6"><label for="varos-filter" class="sr-only">Városok</label><select id="varos-filter" class="form-control" ng-model="location" ng-options="l for l in varosok"><option value="">--</option></select></div></form></div><ul class="col-xs-12 list-group"><li class="list-group-item clearfix" ng-repeat="jogas in jogasok | filter: location | filter:search | orderBy:name"><div class="list-group-item-text">{{jogas.name}} <span ng-if="jogas.nick">({{jogas.nick}})</span></div><div class="pull-right"><a ng-href="#/jogasok/{{jogas._id}}" class="btn btn-default"><i class="fa fa-user"></i> Adatok</a> <a ng-href="#/jogasok/{{jogas._id}}/berlet" class="btn btn-default"><i class="fa fa-star-half"></i>Bérletek</a> <a href="#/jogasok/{{jogas._id}}/alkalmak" class="btn btn-default"><i class="fa fa-calendar"></i>Történet</a></div></li></ul></div><div class="col-xs-6"><h3>Új jógázó</h3><form role="form" ng-submit="addJogas(jogas)" ng-hide="search"><div class="form-group"><label for="jogas-name">Név</label> <input id="jogas-name" class="form-control" type="text" value="{{jogas.name}}" ng-model="jogas.name" ng-required="true"></div><div class="form-group"><label for="jogas-nick">Becenév</label> <input id="jogas-nick" class="form-control" type="text" value="{{jogas.nick}}" ng-model="jogas.nick"></div><div class="form-group"><label for="jogas-email">E-mail</label> <input id="jogas-email" class="form-control" type="text" value="{{jogas.email}}" ng-model="jogas.email"></div><div class="form-group"><label for="jogas-city">Város:</label><select id="jogas-city" class="form-control" ng-model="jogas.city" ng-options="l for l in varosok" ng-required="true"></select></div><div class="form-group"><label for="jogas-note">Egyéb:</label> <textarea id="jogas-note" class="form-control" ng-model="jogas.note" placeholder="Hogyan talált ide? Van-e valami sérülése?"></textarea></div><button type="submit" class="btn btn-primary">Add</button></form></div></div></section>'),a.put("app/login/login-form.html",'<div class="modal"><div class="modal-backdrop in"></div><div class="modal-dialog"><form class="modal-content" name="loginForm" action="sink.html" target="sink" method="post" ng-submit="login(credentials)" novalidate="" form-autofill-fix=""><div class="modal-header"><h4 class="modal-title">Bejelentkezés</h4></div><div class="modal-body"><div class="form-group"><label for="username">Username:</label> <input class="form-control" type="text" id="username" autofocus="" ng-model="credentials.username" ng-required=""></div><div class="form-group"><label for="password">Password:</label> <input class="form-control" type="password" id="password" ng-model="credentials.password" ng-required=""></div></div><div class="modal-footer"><a class="btn" ng-href="#/register" ng-click="hideDialog()">Reg</a> <button type="submit" class="btn btn-primary">Login</button></div></form></div></div>'),a.put("app/login/registration-form.html",'<form name="registrationForm" action="sink.html" target="sink" method="post" ng-submit="register(credentials)" novalidate=""><div class="form-group"><label for="username">Username:</label> <input class="form-control" type="text" id="username" autofocus="" ng-model="credentials.username" ng-required=""></div><div class="form-group"><label for="password">Password:</label> <input class="form-control" type="password" id="password" ng-model="credentials.password" ng-required=""></div><div class="form-group"><label for="password2">Password repeat:</label> <input class="form-control" type="password" id="password2" ng-model="credentials.password2" ng-required=""></div><button type="submit" class="btn btn-primary">Register</button></form>'),a.put("app/pages/home.html",'<section class="section container-fluid"><h1 class="page-header">Welcome to Jógaadminisztátor</h1></section>'),a.put("app/pages/register.html",'<section class="section container-fluid"><h1 class="page-header">Regiszter</h1><bk-registration-form></bk-registration-form></section>'),a.put("app/pages/sidebar.html",'<h1 class="app-name">Jógaadminisztátor</h1><div class="scrollable"><h1 class="scrollable-header app-name">Jógaadminisztátor</h1><div class="scrollable-content"><div class="list-group" ui-turn-off="uiSidebarLeft"><a class="list-group-item" href="/">Home <i class="fa fa-chevron-right pull-right"></i></a> <a class="list-group-item" href="#/alkalmak/uj">Új Alkalom <i class="fa fa-chevron-right pull-right"></i></a> <a class="list-group-item" href="#/alkalmak">Alkalmak <i class="fa fa-chevron-right pull-right"></i></a> <a class="list-group-item" href="#/jogasok">Jógázók <i class="fa fa-chevron-right pull-right"></i></a></div></div><div class="scrollable-footer"><div ng-if="currentUser">{{ currentUser.name }}</div><div ng-if="!currentUser">Log in</div></div></div>')}]);